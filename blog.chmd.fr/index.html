<!DOCTYPE html>
<html lang="en">
<head>
                <title>Ch-M.D</title>
        <meta charset="utf-8" />
                <link href="http://blog.chmd.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D Full Atom Feed" />
                                                                        
        <link rel="stylesheet" href="/theme/css/rdark.css" />
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D ATOM Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="">Ch-M.D <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
                                          </ul></nav><!-- /#menu -->
        <section id="content">

                                                    <header>
                    <h1><a href="/git-on-lighttpd.html"
                            id="page-title">Git on lighttpd</a></h1>
                                            <time datetime="2013-08-08T16:09:00">Thu 08 August 2013</time>
                                    </header>
                <article>
                    <h1>Intro</h1>
<p>I switched to lighttpd. The main reason for this change was the ease of
configuration: for example, with apache, when you want to serve the same
website with and without ssl, you end up doing something like this:</p>
<div class="highlight"><pre><span class="err">#</span> <span class="nb">file</span><span class="p">:</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">sites</span><span class="na">-available</span><span class="p">/</span><span class="nx">domain.com.conf</span>
<span class="o">&lt;</span><span class="nx">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">80</span><span class="o">&gt;</span>
    <span class="nb">Include</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">domain.com.inc.conf</span>
<span class="o">&lt;/</span><span class="nx">VirtualHost</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">443</span><span class="o">&gt;</span>
    <span class="nb">Include</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">domain.com.inc.conf</span>
    <span class="nx">SSLEngine</span> <span class="k">On</span>
    <span class="nx">SSLCertificateFile</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">ssl</span><span class="p">/</span><span class="k">private</span><span class="p">/</span><span class="nx">domain.com.pem</span>
<span class="o">&lt;/</span><span class="nx">VirtualHost</span><span class="o">&gt;</span>

<span class="err">#</span> <span class="nb">file</span><span class="p">:</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">sites</span><span class="na">-available</span><span class="p">/</span><span class="nx">domain.com.inc.conf</span>
<span class="nb">ServerName</span> <span class="nx">domain.com</span>
<span class="nb">DocumentRoot</span> <span class="p">/</span><span class="nb">var</span><span class="p">/</span><span class="nx">www</span><span class="p">/</span><span class="nx">domain.com</span>
</pre></div>


<p>Including the website config as a separate file is pretty much the only
way to accomplish this without duplicating this config in both
virtualhosts. That is two files to maintain, for one domain.  If you want
to do this for every domain you control, you have to multiply the files
and includes.</p>
<p>Doing this with lighttpd is really easier:</p>
<div class="highlight"><pre><span class="cp"># file /etc/lighttpd/lighttpd.conf</span>
<span class="err">$</span><span class="n">SERVER</span><span class="p">[</span><span class="s">&quot;socket&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;:443&quot;</span> <span class="p">{</span>
    <span class="n">ssl</span><span class="p">.</span><span class="n">engine</span>              <span class="o">=</span> <span class="s">&quot;enable&quot;</span>
    <span class="n">ssl</span><span class="p">.</span><span class="n">pemfile</span>             <span class="o">=</span> <span class="s">&quot;/etc/ssl/private/domain.com.pem&quot;</span>
<span class="p">}</span>
<span class="err">$</span><span class="n">HTTP</span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;domain.com&quot;</span> <span class="p">{</span>
    <span class="n">server</span><span class="p">.</span><span class="n">document</span><span class="o">-</span><span class="n">root</span>    <span class="o">=</span> <span class="s">&quot;/var/www/domain.com&quot;</span>
<span class="p">}</span>
</pre></div>


<h1>git and lighttpd</h1>
<p>Now, let's do cool things. One of the subdomains I own is dedicated to
hosting my public git repositories. I (quite obviously) named it
<a href="http://git.chmd.fr">http://git.chmd.fr</a>. I want to use it for:</p>
<ul>
<li>Serving a gitweb instance to browse all repositories, such that
  <a href="https://git.chmd.fr/?p=netmon.git">https://git.chmd.fr/?p=netmon.git</a>
  takes you to browsing the repository of netmon.</li>
<li>Serving the git protocol, such that
  <code>git clone https://git.chmd.fr/netmon.git</code> clones this repository.</li>
</ul>
<p>Combining the two was tricky, but I ended up finding how to proceed. Here
is the relevant part of my config:</p>
<div class="highlight"><pre><span class="err">$</span><span class="n">HTTP</span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;git.chmd.fr&quot;</span> <span class="p">{</span>

    <span class="err">#</span> <span class="n">This</span> <span class="n">takes</span> <span class="n">care</span> <span class="n">of</span> <span class="n">serving</span> <span class="n">gitweb</span>
    <span class="n">server</span><span class="p">.</span><span class="n">document</span><span class="o">-</span><span class="n">root</span>    <span class="o">=</span> <span class="s">&quot;/usr/share/gitweb&quot;</span>
    <span class="n">cgi</span><span class="p">.</span><span class="n">assign</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&quot;.cgi&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span> <span class="p">)</span>
    <span class="n">server</span><span class="p">.</span><span class="n">indexfiles</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&quot;gitweb.cgi&quot;</span> <span class="p">)</span>

    <span class="err">#</span> <span class="n">And</span> <span class="n">this</span> <span class="n">condition</span> <span class="n">matches</span> <span class="n">git</span> <span class="n">objects</span>
    <span class="err">$</span><span class="n">HTTP</span><span class="p">[</span><span class="s">&quot;url&quot;</span><span class="p">]</span> <span class="o">=~</span> <span class="s">&quot;(?x)^/(.*/(HEAD | info/refs | objects/(info/[^/]+ | [0-9a-f]{2}/[0-9a-f]{38} | pack/pack-[0-9a-f]{40}\.(pack|idx)) | git-(upload|receive)-pack))$&quot;</span> <span class="p">{</span>
        <span class="n">alias</span><span class="p">.</span><span class="n">url</span>  <span class="o">+=</span> <span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;/usr/lib/git-core/git-http-backend&quot;</span><span class="p">)</span>
        <span class="n">cgi</span><span class="p">.</span><span class="n">assign</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">setenv</span><span class="p">.</span><span class="n">add</span><span class="o">-</span><span class="n">environment</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;GIT_PROJECT_ROOT&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;/home/www/git-public-repos/&quot;</span><span class="p">,</span>
            <span class="s">&quot;GIT_HTTP_EXPORT_ALL&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span>
            <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Combined with the trick from above, you can get this to work on both http
and https. I hope this will help others!</p>
                </article>
                            <section id="article-list">
                    <h2>All posts</h2>
                    <ol>
                                                                                        <li><a href="/sigal-a-static-gallery-generator.html" rel="bookmark" title="Permalink to Sigal, a static gallery generator">Sigal, a static gallery generator</a></li>
                                                            <li><a href="/jabber-notifications-on-ssh-login.html" rel="bookmark" title="Permalink to Jabber notifications on ssh login">Jabber notifications on ssh login</a></li>
                                                            <li><a href="/choose-your-passphrase-with-a-die.html" rel="bookmark" title="Permalink to Choose your passphrase with a die">Choose your passphrase with a die</a></li>
                                                            <li><a href="/operations-research-and-beer-drinking.html" rel="bookmark" title="Permalink to Operations Research and Beer drinking">Operations Research and Beer drinking</a></li>
                                                            <li><a href="/releasing-michel-a-flat-text-file-to-google-tasks-uploader.html" rel="bookmark" title="Permalink to Releasing Michel, a flat-text-file-to-google-tasks uploader">Releasing Michel, a flat-text-file-to-google-tasks uploader</a></li>
                                                            <li><a href="/going-static.html" rel="bookmark" title="Permalink to Going static">Going static</a></li>
                                                            <li><a href="/plowbot-a-jabber-bot-that-downloads-links-from-1-click-hosters.html" rel="bookmark" title="Permalink to plowbot, a jabber bot that downloads links from 1-click hosters">plowbot, a jabber bot that downloads links from 1-click hosters</a></li>
                                                            <li><a href="/ssh-over-ssl-episode-3-avoiding-using-a-patched-apache.html" rel="bookmark" title="Permalink to SSH over SSL, episode 3: Avoiding using a patched apache.">SSH over SSL, episode 3: Avoiding using a patched apache.</a></li>
                                                            <li><a href="/je-prefere-ton-clone-padopi.html" rel="bookmark" title="Permalink to [Je préfère ton clone] padopi">[Je préfère ton clone] padopi</a></li>
                                                            <li><a href="/using-a-shell-version-of-supergenpass-from-vimperatorpentadactyl.html" rel="bookmark" title="Permalink to Using a shell version of supergenpass from vimperator/pentadactyl">Using a shell version of supergenpass from vimperator/pentadactyl</a></li>
                                                            <li><a href="/saving-your-crontab-in-your-dotfiles.html" rel="bookmark" title="Permalink to Saving your crontab in your dotfiles">Saving your crontab in your dotfiles</a></li>
                                                            <li><a href="/notifications-from-google-calendar-on-my-desktop.html" rel="bookmark" title="Permalink to Notifications from google calendar on my desktop">Notifications from google calendar on my desktop</a></li>
                                                            <li><a href="/ssh-over-ssl-episode-2-replacing-proxytunnel-with-socat.html" rel="bookmark" title="Permalink to SSH over SSL, episode 2: replacing proxytunnel with socat">SSH over SSL, episode 2: replacing proxytunnel with socat</a></li>
                                                            <li><a href="/ssh-over-ssl-a-quick-and-minimal-config.html" rel="bookmark" title="Permalink to SSH over SSL, a quick and minimal config.">SSH over SSL, a quick and minimal config.</a></li>
                                                            <li><a href="/vim-complete-c-accurately-pulling-informations-from-the-compiler-with-gccsense-and-clang_complete.html" rel="bookmark" title="Permalink to Vim: complete C++ accurately, pulling informations from the compiler, with gccsense and clang_complete">Vim: complete C++ accurately, pulling informations from the compiler, with gccsense and clang_complete</a></li>
                                                            <li><a href="/google-releasing-a-constraint-programming-library.html" rel="bookmark" title="Permalink to Google releasing a constraint programming library">Google releasing a constraint programming library</a></li>
                                                            <li><a href="/mise-a-jour-de-talkmyphone.html" rel="bookmark" title="Permalink to Mise à jour de TalkMyPhone">Mise à jour de TalkMyPhone</a></li>
                                                            <li><a href="/talkmyphone-une-appli-android-pour-recevoir-des-notifications-de-son-telephone.html" rel="bookmark" title="Permalink to TalkMyPhone, une appli android pour recevoir des notifications de son téléphone">TalkMyPhone, une appli android pour recevoir des notifications de son téléphone</a></li>
                                                            <li><a href="/de-linteret-de-detacher-des-programmes-de-la-console-sans-screen.html" rel="bookmark" title="Permalink to De l'intérêt de détacher des programmes de la console (sans screen)">De l'intérêt de détacher des programmes de la console (sans screen)</a></li>
                                                            <li><a href="/renaming-files-and-variables-from-vim.html" rel="bookmark" title="Permalink to renaming files and variables from vim">renaming files and variables from vim</a></li>
                                                            <li><a href="/continuous-background-compilation-within-vim.html" rel="bookmark" title="Permalink to Continuous background compilation within vim">Continuous background compilation within vim</a></li>
                                                            <li><a href="/utilisons-incron-pour-etre-notifies-des-evenements-du-systeme-de-fichiers.html" rel="bookmark" title="Permalink to Utilisons incron pour être notifiés des événements du système de fichiers">Utilisons incron pour être notifiés des événements du système de fichiers</a></li>
                                                            <li><a href="/la-todo-liste-du-pauvre.html" rel="bookmark" title="Permalink to La TODO liste du pauvre">La TODO liste du pauvre</a></li>
                                                            <li><a href="/gerer-ses-plugins-vim-avec-getlatestvimscripts.html" rel="bookmark" title="Permalink to Gérer ses plugins vim avec :GetLatestVimScripts">Gérer ses plugins vim avec :GetLatestVimScripts</a></li>
                                                            <li><a href="/gdb-70-est-sorti-cest-une-merveille-et-vous-ne-le-saviez-pas.html" rel="bookmark" title="Permalink to gdb 7.0 est sorti, c'est une merveille et vous ne le saviez pas.">gdb 7.0 est sorti, c'est une merveille et vous ne le saviez pas.</a></li>
                                                            <li><a href="/autotools-doxygen-et-generation-conditionnelle.html" rel="bookmark" title="Permalink to autotools, doxygen, et génération conditionnelle">autotools, doxygen, et génération conditionnelle</a></li>
                                                            <li><a href="/mettre-des-couleurs-un-peu-partout-gcc-diff-grep.html" rel="bookmark" title="Permalink to Mettre des couleurs un peu partout (gcc, diff, grep...)">Mettre des couleurs un peu partout (gcc, diff, grep...)</a></li>
                                                            <li><a href="/vimgdbvimgdb.html" rel="bookmark" title="Permalink to vim+gdb=vimgdb">vim+gdb=vimgdb</a></li>
                                                            <li><a href="/luml-automatise-et-le-libre-cest-pas-gagne.html" rel="bookmark" title="Permalink to l'UML automatisé et le libre : c'est pas gagné!">l'UML automatisé et le libre : c'est pas gagné!</a></li>
                                                            <li><a href="/les-lecteurs-de-flux-rss-en-ligne-independants-libres-suite.html" rel="bookmark" title="Permalink to Les lecteurs de flux rss, en ligne, indépendants, libres (suite).">Les lecteurs de flux rss, en ligne, indépendants, libres (suite).</a></li>
                                                            <li><a href="/les-lecteurs-de-flux-rss-en-ligne-libres.html" rel="bookmark" title="Permalink to Les lecteurs de flux rss en ligne libres">Les lecteurs de flux rss en ligne libres</a></li>
                                                            <li><a href="/couper-une-video-et-extraire-une-scene-dun-film.html" rel="bookmark" title="Permalink to Couper une vidéo et extraire une scène d'un film">Couper une vidéo et extraire une scène d'un film</a></li>
                                                            <li><a href="/faire-un-gif-anime-a-partir-dun-film.html" rel="bookmark" title="Permalink to Faire un gif animé à partir d'un film">Faire un gif animé à partir d'un film</a></li>
                                        </ol>
            </section><!-- #article-list -->
            
    <hr />
    <a href="/feeds/all.atom.xml">Atom feed</a></li>

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>