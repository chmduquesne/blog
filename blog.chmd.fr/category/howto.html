<!DOCTYPE html>
<html lang="en">
<head>
                <title>Ch-M.D</title>
        <meta charset="utf-8" />
                <link href="http://blog.chmd.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D Full Atom Feed" />
                                                <link href="http://blog.chmd.fr/feeds/howto.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D Categories Atom Feed" />
                                        
        <link rel="stylesheet" href="/theme/css/rdark.css" />
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D ATOM Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="">Ch-M.D <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
                                          </ul></nav><!-- /#menu -->
        <section id="content">
<h2>Articles in the howto category</h2>

                                                    <header>
                    <h1><a href="/using-openid-and-the-likes-to-protect-static-content.html"
                            id="page-title">Using openid and the likes to protect static content</a></h1>
                                            <time datetime="2013-10-29T14:22:00">Tue 29 October 2013</time>
                                    </header>
                <article>
                    <p>I <a href="/sigal-a-static-gallery-generator.html">recently</a> set up a self-hosted
gallery for my pictures. Obviously, I did this because I wanted to stop
giving my content to external platforms, but also to gain some level of
privacy: I want to limit the number of people who are able to look at
these pictures.</p>
<p>While setting up the gallery was relatively easy, restricting the access
was an interesting problem. I did not want to use a global
<code>username:password</code> combination, because this kind of credentials
inevitably become public at some point. A different combination for each
user would have been better, but some people are not as careful as I am
with their own credentials, and they may just give away their own access
to others. It is also a lot of maintenance, and I don't want to deal with
the risks involved with securely processing my friends' passwords.</p>
<p>I then had a look at single sign on solutions such as openid. This kind of
technology was appealing, for several reasons:</p>
<ul>
<li>No password to process on my side</li>
<li>People would identify with a very personal account (gmail, facebook),
  that they are unlikely to be willing to share with anyone else.</li>
<li>It is very easy to use for the end user.</li>
</ul>
<p>I have thus been looking for a solution to get openid/oauth authentication
to cooperate with lighttpd in order to protect my new gallery. After some
work, I came up with <a href="https://git.chmd.fr/?p=lighttpd-external-auth;a=blob_plain;f=external-auth.lua">a lua magnet
script</a>
that does the job. It is inspired by <a href="https://github.com/tai/mod-auth-ticket-for-lighttpd">this
module</a>, but it does
not require to be compiled and works out of the box on recent versions of
lighttpd (e.g.  debian stable). I also believe that it offers <a href="https://github.com/tai/mod-auth-ticket-for-lighttpd/issues/4">a better
security</a>.</p>
<p>It works pretty well! You can try to visit
<a href="https://gallery.chmd.fr">gallery.chmd.fr</a>  and you should be presented
with my very own login page. Should you try to login, the script will
gently tell you that though your openid/oauth login was successful, you
cannot access the gallery because it is a privilege reserved to the people
I explicitly authorized. Beware that if you are not using linux, you might
experiment a warning from your browser: that is because I use a
certificate signed by <a href="http://www.cacert.org/">cacert</a>, a community-driven
certificate authority whose root certificate is not included in commercial
OS (yet).</p>
<p>If you want to use this script on your own lighttpd server, I have set up
a <a href="http://lighttpd-external-auth.chmd.fr/">dedicated website</a> to explain
how to proceed. Check it out!</p>
<p>One last thing: I am not a security expert, and I did this for fun. I
believe it is pretty secure (provided you trust the third parties
involved, of course), but I still have to warn you: don't use this to
protect important documents. If you have knowledge about security and want
to comment - or even better: to contribute - be my guest!</p>
                </article>
                            <section id="article-list">
                    <h2>All posts</h2>
                    <ol>
                                                                                        <li><a href="/git-on-lighttpd.html" rel="bookmark" title="Permalink to Git on lighttpd">Git on lighttpd</a></li>
                                                            <li><a href="/jabber-notifications-on-ssh-login.html" rel="bookmark" title="Permalink to Jabber notifications on ssh login">Jabber notifications on ssh login</a></li>
                                                            <li><a href="/choose-your-passphrase-with-a-die.html" rel="bookmark" title="Permalink to Choose your passphrase with a die">Choose your passphrase with a die</a></li>
                                                            <li><a href="/ssh-over-ssl-episode-3-avoiding-using-a-patched-apache.html" rel="bookmark" title="Permalink to SSH over SSL, episode 3: Avoiding using a patched apache.">SSH over SSL, episode 3: Avoiding using a patched apache.</a></li>
                                                            <li><a href="/using-a-shell-version-of-supergenpass-from-vimperatorpentadactyl.html" rel="bookmark" title="Permalink to Using a shell version of supergenpass from vimperator/pentadactyl">Using a shell version of supergenpass from vimperator/pentadactyl</a></li>
                                                            <li><a href="/saving-your-crontab-in-your-dotfiles.html" rel="bookmark" title="Permalink to Saving your crontab in your dotfiles">Saving your crontab in your dotfiles</a></li>
                                                            <li><a href="/notifications-from-google-calendar-on-my-desktop.html" rel="bookmark" title="Permalink to Notifications from google calendar on my desktop">Notifications from google calendar on my desktop</a></li>
                                                            <li><a href="/ssh-over-ssl-episode-2-replacing-proxytunnel-with-socat.html" rel="bookmark" title="Permalink to SSH over SSL, episode 2: replacing proxytunnel with socat">SSH over SSL, episode 2: replacing proxytunnel with socat</a></li>
                                                            <li><a href="/ssh-over-ssl-a-quick-and-minimal-config.html" rel="bookmark" title="Permalink to SSH over SSL, a quick and minimal config.">SSH over SSL, a quick and minimal config.</a></li>
                                                            <li><a href="/de-linteret-de-detacher-des-programmes-de-la-console-sans-screen.html" rel="bookmark" title="Permalink to De l'intérêt de détacher des programmes de la console (sans screen)">De l'intérêt de détacher des programmes de la console (sans screen)</a></li>
                                                            <li><a href="/utilisons-incron-pour-etre-notifies-des-evenements-du-systeme-de-fichiers.html" rel="bookmark" title="Permalink to Utilisons incron pour être notifiés des événements du système de fichiers">Utilisons incron pour être notifiés des événements du système de fichiers</a></li>
                                                            <li><a href="/la-todo-liste-du-pauvre.html" rel="bookmark" title="Permalink to La TODO liste du pauvre">La TODO liste du pauvre</a></li>
                                                            <li><a href="/gerer-ses-plugins-vim-avec-getlatestvimscripts.html" rel="bookmark" title="Permalink to Gérer ses plugins vim avec :GetLatestVimScripts">Gérer ses plugins vim avec :GetLatestVimScripts</a></li>
                                                            <li><a href="/mettre-des-couleurs-un-peu-partout-gcc-diff-grep.html" rel="bookmark" title="Permalink to Mettre des couleurs un peu partout (gcc, diff, grep...)">Mettre des couleurs un peu partout (gcc, diff, grep...)</a></li>
                                                            <li><a href="/faire-un-gif-anime-a-partir-dun-film.html" rel="bookmark" title="Permalink to Faire un gif animé à partir d'un film">Faire un gif animé à partir d'un film</a></li>
                                        </ol>
            </section><!-- #article-list -->
            
    <hr />
    <a href="/feeds/all.atom.xml">Atom feed</a></li>

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>