<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Ch-M.D</title>
    <meta name="description" content="">
    <meta name="author" content="Tof">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://blog.chmd.fr/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-icons.min.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/local.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/pygments.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Gudea:400,400italic|Alegreya+SC' rel='stylesheet' type='text/css'>
</head>

<body>
<header class="blog-header">
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
	<a href="http://blog.chmd.fr" class="brand">Ch-M.D</a>
      </div>

      <div class="span3" id="blog-nav">
	<ul class="nav nav-pills pull-right">
	                        	   	    <li >
	      <a href="http://blog.chmd.fr/category/code.html ">code</a>
	   	    <li >
	      <a href="http://blog.chmd.fr/category/howto.html ">howto</a>
	   	    <li >
	      <a href="http://blog.chmd.fr/category/misc.html ">misc</a>
	   	</ul>
      </div>
    </div> <!-- End of fluid row-->
  </div>   <!-- End of Container-->
</header>
    
<div class="container">
    <div class="content">
    <div class="row-fluid">

        <div class="span10">
                

        

    <div class='row-fluid''>
        <div class="article-title span9">
            <a href="http://blog.chmd.fr/git-on-lighttpd.html"><h1>Git on lighttpd</h1></a>
        </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
	<p>Thu 08 August 2013 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.chmd.fr/category/howto.html">howto</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.chmd.fr/tag/git-gitweb-server.html">git gitweb server</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="chmduquesne">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="article-content span8">
	<h1>Intro</h1>
<p>I switched to lighttpd. The main reason for this change was the ease of
configuration: for example, with apache, when you want to serve the same
website with and without ssl, you end up doing something like this:</p>
<div class="highlight"><pre><span class="err">#</span> <span class="nb">file</span><span class="p">:</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">sites</span><span class="na">-available</span><span class="p">/</span><span class="nx">domain.com.conf</span>
<span class="o">&lt;</span><span class="nx">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">80</span><span class="o">&gt;</span>
    <span class="nb">Include</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">domain.com.inc.conf</span>
<span class="o">&lt;/</span><span class="nx">VirtualHost</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">443</span><span class="o">&gt;</span>
    <span class="nb">Include</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">domain.com.inc.conf</span>
    <span class="nx">SSLEngine</span> <span class="k">On</span>
    <span class="nx">SSLCertificateFile</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">ssl</span><span class="p">/</span><span class="k">private</span><span class="p">/</span><span class="nx">domain.com.pem</span>
<span class="o">&lt;/</span><span class="nx">VirtualHost</span><span class="o">&gt;</span>

<span class="err">#</span> <span class="nb">file</span><span class="p">:</span> <span class="p">/</span><span class="nx">etc</span><span class="p">/</span><span class="nx">apache2</span><span class="p">/</span><span class="nx">sites</span><span class="na">-available</span><span class="p">/</span><span class="nx">domain.com.inc.conf</span>
<span class="nb">ServerName</span> <span class="nx">domain.com</span>
<span class="nb">DocumentRoot</span> <span class="p">/</span><span class="nb">var</span><span class="p">/</span><span class="nx">www</span><span class="p">/</span><span class="nx">domain.com</span>
</pre></div>


<p>Including the website config as a separate file is pretty much the only
way to accomplish this without duplicating this config in both
virtualhosts. That is two files to maintain, for one domain.  If you want
to do this for every domain you control, you have to multiply the files
and includes.</p>
<p>Doing this with lighttpd is really easier:</p>
<div class="highlight"><pre><span class="cp"># file /etc/lighttpd/lighttpd.conf</span>
<span class="err">$</span><span class="n">SERVER</span><span class="p">[</span><span class="s">&quot;socket&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;:443&quot;</span> <span class="p">{</span>
    <span class="n">ssl</span><span class="p">.</span><span class="n">engine</span>              <span class="o">=</span> <span class="s">&quot;enable&quot;</span>
    <span class="n">ssl</span><span class="p">.</span><span class="n">pemfile</span>             <span class="o">=</span> <span class="s">&quot;/etc/ssl/private/domain.com.pem&quot;</span>
<span class="p">}</span>
<span class="err">$</span><span class="n">HTTP</span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;domain.com&quot;</span> <span class="p">{</span>
    <span class="n">server</span><span class="p">.</span><span class="n">document</span><span class="o">-</span><span class="n">root</span>    <span class="o">=</span> <span class="s">&quot;/var/www/domain.com&quot;</span>
<span class="p">}</span>
</pre></div>


<h1>git and lighttpd</h1>
<p>Now, let's do cool things. One of the subdomains I own is dedicated to
hosting my public git repositories. I (quite obviously) named it
<a href="http://git.chmd.fr">http://git.chmd.fr</a>. I want to use it for:</p>
<ul>
<li>Serving a gitweb instance to browse all repositories, such that
  <a href="https://git.chmd.fr/?p=netmon.git">https://git.chmd.fr/?p=netmon.git</a>
  takes you to browsing the repository of netmon.</li>
<li>Serving the git protocol, such that
  <code>git clone https://git.chmd.fr/netmon.git</code> clones this repository.</li>
</ul>
<p>Combining the two was tricky, but I ended up finding how to proceed. Here
is the relevant part of my config:</p>
<div class="highlight"><pre><span class="err">$</span><span class="n">HTTP</span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;git.chmd.fr&quot;</span> <span class="p">{</span>

    <span class="err">#</span> <span class="n">This</span> <span class="n">takes</span> <span class="n">care</span> <span class="n">of</span> <span class="n">serving</span> <span class="n">gitweb</span>
    <span class="n">server</span><span class="p">.</span><span class="n">document</span><span class="o">-</span><span class="n">root</span>    <span class="o">=</span> <span class="s">&quot;/usr/share/gitweb&quot;</span>
    <span class="n">cgi</span><span class="p">.</span><span class="n">assign</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&quot;.cgi&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span> <span class="p">)</span>
    <span class="n">server</span><span class="p">.</span><span class="n">indexfiles</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&quot;gitweb.cgi&quot;</span> <span class="p">)</span>

    <span class="err">#</span> <span class="n">And</span> <span class="n">this</span> <span class="n">condition</span> <span class="n">matches</span> <span class="n">git</span> <span class="n">objects</span>
    <span class="err">$</span><span class="n">HTTP</span><span class="p">[</span><span class="s">&quot;url&quot;</span><span class="p">]</span> <span class="o">=~</span> <span class="s">&quot;(?x)^/(.*/(HEAD | info/refs | objects/(info/[^/]+ | [0-9a-f]{2}/[0-9a-f]{38} | pack/pack-[0-9a-f]{40}\.(pack|idx)) | git-(upload|receive)-pack))$&quot;</span> <span class="p">{</span>
        <span class="n">alias</span><span class="p">.</span><span class="n">url</span>  <span class="o">+=</span> <span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;/usr/lib/git-core/git-http-backend&quot;</span><span class="p">)</span>
        <span class="n">cgi</span><span class="p">.</span><span class="n">assign</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">setenv</span><span class="p">.</span><span class="n">add</span><span class="o">-</span><span class="n">environment</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;GIT_PROJECT_ROOT&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;/home/www/git-public-repos/&quot;</span><span class="p">,</span>
            <span class="s">&quot;GIT_HTTP_EXPORT_ALL&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span>
            <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Combined with the trick from above, you can get this to work on both http
and https. I hope this will help others!</p> 
	<a class="btn btn-mini xsmall" href="http://blog.chmd.fr/git-on-lighttpd.html">
          <i class="icon-comment"></i> Comment </a>
	<hr />
      </div>
      
    </div>
    
            <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://blog.chmd.fr/tag/git-gitweb-server.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>    
 
  
        </div>
        
        
    </div>     </div> </div>

<!--footer-->
<div class="container">
  <div class="well" style="background-color: #E9EFF6">
    <div id="blog-footer">
      <div class="row-fluid">
		<div class="social span2" align="center" id="socialist">
	  <ul class="nav nav-list">
	    <li class="nav-header">
	      Social
	    </li>
	    	    <li><a href="https://twitter.com/#!chmduquesne"><i class="icon-twitter" style="color: #1f334b"></i>twitter</a></li>
	    	    <li><a href="http://resume.chmd.fr"><i class="icon-resume" style="color: #1f334b"></i>resume</a></li>
	                
	  </ul>
	</div>
		        	<div class="site-nav span2" align="center">
          <ul class="nav nav-list" id="site-links">
            <li class="nav-header"> 
              Site
            </li>
            <li><a href="http://blog.chmd.fr"><i class="icon-home" style="color: #1f334b">
                </i>Home</a></li>
            <li><a href="http://blog.chmd.fr/archives.html"><i class="icon-list" style="color: #1f334b">
                </i>Archives</a></li>
	    <li><a href="http://blog.chmd.fr/tags.html"><i class="icon-tags" style="color: #1f334b">
                </i>Tags</a></li>
	    
	                <li><a href="http://blog.chmd.fr/" rel="alternate">
                <i class="icon-rss-sign" style="color: #1f334b"></i>
                Atom Feed</a></li>
	  </ul>

        </div>

      </div> <!--end of fluid row-->
    </div> <!--end of blog-footer-->
    <hr />
    <p align="center"><a href="http://blog.chmd.fr">Ch-M.D</a>
      &copy; Tof
    Powered by <a href="github.com/getpelican/pelican">Pelican</a> and
        <a href="https://twitter.github.com/bootstrap">Twitter Bootstrap</a>. 
        Icons by <a href="http://fortawesome.github.com/Font-Awesome">Font Awesome</a> and 
        <a href="http://gregoryloucas.github.com/Font-Awesome-More">Font Awesome More</a></p>

  </div> <!--end of well -->
</div> <!--end of container -->

<!--/footer-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>


<script>var _gaq=[['_setAccount','UA-17659080-3'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

</body>
</html>