<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Ch-M.D</title>
    <meta name="description" content="">
    <meta name="author" content="Tof">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://blog.chmd.fr/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-icons.min.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/local.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/pygments.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Gudea:400,400italic|Alegreya+SC' rel='stylesheet' type='text/css'>
</head>

<body>
<header class="blog-header">
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
	<a href="http://blog.chmd.fr" class="brand">Ch-M.D</a>
      </div>

      <div class="span3" id="blog-nav">
	<ul class="nav nav-pills pull-right">
	                        	   	    <li >
	      <a href="http://blog.chmd.fr/category/code.html ">code</a>
	   	    <li >
	      <a href="http://blog.chmd.fr/category/howto.html ">howto</a>
	   	    <li >
	      <a href="http://blog.chmd.fr/category/misc.html ">misc</a>
	   	</ul>
      </div>
    </div> <!-- End of fluid row-->
  </div>   <!-- End of Container-->
</header>
    
<div class="container">
    <div class="content">
    <div class="row-fluid">

        <div class="span10">
                

        

    <div class='row-fluid''>
        <div class="article-title span9">
            <a href="http://blog.chmd.fr/de-linteret-de-detacher-des-programmes-de-la-console-sans-screen.html"><h1>De l'intérêt de détacher des programmes de la console (sans screen)</h1></a>
        </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
	<p>Fri 09 April 2010 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.chmd.fr/category/howto.html">howto</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.chmd.fr/tag/tmux.html">tmux</a> <a href="http://blog.chmd.fr/tag/irssi.html">irssi</a> <a href="http://blog.chmd.fr/tag/dtach.html">dtach</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="chmduquesne">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="article-content span8">
	<p>Qui n'a jamais perdu par erreur une compilation, une session ssh ou
une fenêtre irssi en fermant une console par inadvertance, à cause
d'un lag réseau, ou bien à cause d'un redémarrage brutal de X11?</p>
<p>Les outils présentés ici permettent de vous affranchir de ce genre
de problème. dtach est un petit programme bien pratique qui sert à
détacher un programme de la console où celui-ci tourne. De manière
simple, ça veut dire que si on quitte le terminal dans lequel on a
lancé le programme détaché, on pourra par une courte commande
récupérer ce programme.</p>
<p>Exemple, la commande suivante permet de
lancer le programme irssi en détaché, sur le socket /tmp/irssi.sock
(qui sera créé par le programme), où, s'il est déjà lancé, de
récupérer ce programme.</p>
<div class="highlight"><pre><span class="n">dtach</span> <span class="o">-</span><span class="n">A</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">irssi</span><span class="p">.</span><span class="n">sock</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irssi</span>
</pre></div>


<p>J'en connais des tas qui ne jurent que par gnu screen. Mais  à quoi
bon, si on peut se contenter d'un simple alias?</p>
<div class="highlight"><pre><span class="n">alias</span> <span class="n">irssi</span><span class="o">=</span><span class="err">&#39;</span><span class="n">dtach</span> <span class="o">-</span><span class="n">A</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">irssi</span><span class="p">.</span><span class="n">sock</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irssi</span><span class="err">&#39;`</span>
</pre></div>


<p>Jusque là, je me contentais de deux ou trois alias du genre, et j'avais
une petite fonction au début de mon .zshrc qui me permettait de toujours
lancer mon shell en détaché. Cependant, tout ceci manquant de souplesse,
je me suis intéressé à screen et à ses alternatives, et je dois dire que
je trouve tmux vraiment propre. Je mets de côté tous les aspects de
coupage d'écran en deux, onglets et tutti quanti, qui  sont plus ou moins
inutiles quand on utilise <a href="http://awesome.naquadah.org/">un vrai window manager</a>.</p>
<p>Si screen et tmux peuvent tous deux ouvrir un nombre illimité de sessions
(screen pouvant, si j'ai bien compris, ouvrir jusqu'à 10 fenêtres au sein
de la même session), tmux offre un mécanisme pour alterner entre
différentes sessions que j'ai cherché en vain dans screen (je vois d'ici
les ardents défenseurs de leur programme favori venir me crucifier dans
les commentaires: tant pis, si ça existe, j'assume ma mauvaise lecture des
pages de manuel).</p>
<p>Dans tmux, avec la configuration par défaut, un simple CTRL-b suivi de s
montre une liste à choix des sessions ouvertes (attachées ou détachées) et
il suffit alors de selectionner une entrée pour que tmux se connecte à
ladite session (et si vous aimez couper l'écran en deux et mettre
plusieurs fenêtres dans la même session, vous pouvez, sans limitation de
nombre).</p>
<p>Voici quelques lignes que j'ai rajoutées au début de mon .zshrc: elles
garantissent qu'une nouvelle session tmux est toujours lancée avec le
shell. La fermeture de la session en cours entraine l'essai de connection
à une autre session, sauf s'il n'y a plus aucune session de lancée.</p>
<div class="highlight"><pre># TMUX
# if no session is started, start a new session
if test -z <span class="cp">${</span><span class="n">TMUX</span><span class="cp">}</span>; then
    tmux
fi
# when quitting tmux, try to attach
while test -z <span class="cp">${</span><span class="n">TMUX</span><span class="cp">}</span>; do
    tmux attach || break
done
</pre></div>


<p>Et désormais je lance irssi de la manière suivante:</p>
<div class="highlight"><pre><span class="cp"># IRSSI IN TMUX</span>
<span class="cp"># switch to irssi session (and if necessary starts this session before)</span>
<span class="n">irssi</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="n">tmux</span> <span class="n">has</span> <span class="o">-</span><span class="n">t</span> <span class="n">irssi</span> <span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">;</span> <span class="n">then</span>
         <span class="n">tmux</span> <span class="k">switch</span> <span class="o">-</span><span class="n">t</span> <span class="n">irssi</span>
    <span class="k">else</span>
        <span class="n">TMUX</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="n">tmux</span> <span class="n">new</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">s</span> <span class="n">irssi</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irssi</span>
        <span class="n">tmux</span> <span class="k">switch</span> <span class="o">-</span><span class="n">t</span> <span class="n">irssi</span>
    <span class="n">fi</span>
<span class="p">}</span>
</pre></div>


<p>Si vous utilisez zsh et/ou urxvt, et que vous souhaitez tenter l'essai, je
vous suggère de jeter un coup d'oeil à <a href="https://github.com/chmduquesne/dotfiles/">ma configuration</a> (les
problèmes de couleurs et de scrolling y sont réglés). À noter qu'il existe
d'autres alternatives à gnu screen, dont le très prometteur <a href="http://caca.zoy.org/wiki/neercs">neercs</a>,
qui permet entre autre de détacher des programmes qu'on avait oublié de
lancer dans neercs.</p> 
	<a class="btn btn-mini xsmall" href="http://blog.chmd.fr/de-linteret-de-detacher-des-programmes-de-la-console-sans-screen.html">
          <i class="icon-comment"></i> Comment </a>
	<hr />
      </div>
      
    </div>
    
            <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://blog.chmd.fr/tag/dtach.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>    
 
  
        </div>
        
        
    </div>     </div> </div>

<!--footer-->
<div class="container">
  <div class="well" style="background-color: #E9EFF6">
    <div id="blog-footer">
      <div class="row-fluid">
		<div class="social span2" align="center" id="socialist">
	  <ul class="nav nav-list">
	    <li class="nav-header">
	      Social
	    </li>
	    	    <li><a href="https://twitter.com/#!chmduquesne"><i class="icon-twitter" style="color: #1f334b"></i>twitter</a></li>
	    	    <li><a href="http://resume.chmd.fr"><i class="icon-resume" style="color: #1f334b"></i>resume</a></li>
	                
	  </ul>
	</div>
		        	<div class="site-nav span2" align="center">
          <ul class="nav nav-list" id="site-links">
            <li class="nav-header"> 
              Site
            </li>
            <li><a href="http://blog.chmd.fr"><i class="icon-home" style="color: #1f334b">
                </i>Home</a></li>
            <li><a href="http://blog.chmd.fr/archives.html"><i class="icon-list" style="color: #1f334b">
                </i>Archives</a></li>
	    <li><a href="http://blog.chmd.fr/tags.html"><i class="icon-tags" style="color: #1f334b">
                </i>Tags</a></li>
	    
	                <li><a href="http://blog.chmd.fr/" rel="alternate">
                <i class="icon-rss-sign" style="color: #1f334b"></i>
                Atom Feed</a></li>
	  </ul>

        </div>

      </div> <!--end of fluid row-->
    </div> <!--end of blog-footer-->
    <hr />
    <p align="center"><a href="http://blog.chmd.fr">Ch-M.D</a>
      &copy; Tof
    Powered by <a href="github.com/getpelican/pelican">Pelican</a> and
        <a href="https://twitter.github.com/bootstrap">Twitter Bootstrap</a>. 
        Icons by <a href="http://fortawesome.github.com/Font-Awesome">Font Awesome</a> and 
        <a href="http://gregoryloucas.github.com/Font-Awesome-More">Font Awesome More</a></p>

  </div> <!--end of well -->
</div> <!--end of container -->

<!--/footer-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>


<script>var _gaq=[['_setAccount','UA-17659080-3'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

</body>
</html>