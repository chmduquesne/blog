<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Ch-M.D</title>
    <meta name="description" content="">
    <meta name="author" content="Tof">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://blog.chmd.fr/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-icons.min.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/local.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/pygments.css" rel="stylesheet">
    <link href="http://blog.chmd.fr/theme/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Gudea:400,400italic|Alegreya+SC' rel='stylesheet' type='text/css'>
</head>

<body>
<header class="blog-header">
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
	<a href="http://blog.chmd.fr" class="brand">Ch-M.D</a>
      </div>

      <div class="span3" id="blog-nav">
	<ul class="nav nav-pills pull-right">
	                        	   	    <li >
	      <a href="http://blog.chmd.fr/category/code.html ">code</a>
	   	    <li >
	      <a href="http://blog.chmd.fr/category/howto.html ">howto</a>
	   	    <li >
	      <a href="http://blog.chmd.fr/category/misc.html ">misc</a>
	   	</ul>
      </div>
    </div> <!-- End of fluid row-->
  </div>   <!-- End of Container-->
</header>
    
<div class="container">
    <div class="content">
    <div class="row-fluid">

        <div class="span10">
                

        

    <div class='row-fluid''>
        <div class="article-title span9">
            <a href="http://blog.chmd.fr/jabber-notifications-on-ssh-login.html"><h1>Jabber notifications on ssh login</h1></a>
        </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
	<p>Wed 19 September 2012 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.chmd.fr/category/howto.html">howto</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.chmd.fr/tag/security.html">security</a> <a href="http://blog.chmd.fr/tag/ssh.html">ssh</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="chmduquesne">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="article-content span8">
	<p>I coined this little trick the other day, I thought I might share it. I
wanted, for fun, to be notified on gtalk everytime someone logs in my
server. You never know, maybe I could discover unexpected connections. It
turned out to be possible, and the whole thing costed me reading a couple
of manpages and typing 5 lines of code.</p>
<p>Before you do the same thing with you own server, let me claim here that I
am absolutely not a security expert. It is more an experiment than
anything else, so I suggest being really careful and read all the manpages
involved if you want to do the same thing. Also, I'd be happy to be
notified of any potential threat in the comments.</p>
<p>Basically, you can have PAM (Pluggable Authentication Modules, the thing
that handles authentication on Linux) execute external commands. The
module in question is called <code>pam_exec</code>, and it is often used to rebuild
databases e.g. when passwords are changed. It can also be activated when
someone logs in. The manpage explains that the following PAM items are
exported as environment variables to the program executed:</p>
<div class="highlight"><pre> <span class="n">PAM_RHOST</span><span class="p">,</span> <span class="n">PAM_RUSER</span><span class="p">,</span> <span class="n">PAM_SERVICE</span><span class="p">,</span> <span class="n">PAM_TTY</span><span class="p">,</span> <span class="n">PAM_USER</span><span class="p">,</span> <span class="n">PAM_TYPE</span>
</pre></div>


<p>I decided to use it to my advantage. I created on jabber.org an account
for my server. I added it in my gmail friends, and I wrote this little
script, using sendxmpp (saved as <code>/usr/local/bin/login_notify</code>):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/sh</span>

<span class="nb">echo</span> <span class="s2">&quot;$PAM_USER@`hostname` logged from $PAM_RHOST&quot;</span> | <span class="se">\</span>
    sendxmpp -u server_account -j jabber.org -p xxxx me@gmail.com &gt;/dev/null 2&gt;&amp;1 &amp;
<span class="nb">exit </span>0
</pre></div>
</td></tr></table>

<p>Note that the sendxmpp command runs in background and that its exit status
is ignored. Otherwise PAM would wait for the command to return before
letting me in, and it would deny me the access if the notification failed
to be delivered. Two things I clearly want to avoid.</p>
<p>Then, the following line goes at the end of <code>/etc/pam.d/sshd</code>:</p>
<div class="highlight"><pre><span class="n">session</span>         <span class="n">optional</span>        <span class="n">pam_exec</span><span class="p">.</span><span class="n">so</span>             <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">login_notify</span>
</pre></div>


<p>There you go, notifications each time someone logs in.</p>
<h1>Are you doing this for real? Read on...</h1>
<p>Ok, just a couple of extra instructions for you:</p>
<ul>
<li>Be really really careful before modifying <code>/etc/pam.d/sshd</code>. If you
  put a bogus command in there, you might screw up your remote access.
  Please double check that the command <code>/usr/local/bin/login_notify</code> is
  running with no error. Only when you are sure of that, you can add the
  line to <code>/etc/pam.d/sshd</code>.</li>
<li>Don't forget to <code>chmod +x /usr/local/bin/login_notify</code></li>
<li>When you run <code>/usr/local/bin/login_notify</code>, you should receive a
  jabber message. If you don't, then you have to verify that you can
  actually send messages to your gmail account. Use a jabber client
  and try to have a conversation with your gmail account. Then, try to
  use <code>sendxmpp</code>, then try again with the <code>login_notify</code> script.</li>
<li>My instructions are probably incomplete. Use your brain to fill in the
  blanks.</li>
</ul> 
	<a class="btn btn-mini xsmall" href="http://blog.chmd.fr/jabber-notifications-on-ssh-login.html">
          <i class="icon-comment"></i> Comment </a>
	<hr />
      </div>
      
    </div>
    
    
 
        



    <div class='row-fluid'>
      <div class='article-title span9'> 
        <a href="http://blog.chmd.fr/ssh-over-ssl-episode-3-avoiding-using-a-patched-apache.html"><h1>SSH over SSL, episode 3: Avoiding using a patched apache.</h1></a>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
	<p>Mon 11 July 2011 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.chmd.fr/category/howto.html">howto</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.chmd.fr/tag/ssh.html">ssh</a> <a href="http://blog.chmd.fr/tag/ssl.html">ssl</a> <a href="http://blog.chmd.fr/tag/stunnel.html">stunnel</a> <a href="http://blog.chmd.fr/tag/apache.html">apache</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="chmduquesne">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="summary span8">
	<p>Another episode of my adventures of firewall bypassing...</p>
<p>In order to use the http CONNECT method to tunnel ssh, you have to
configure apache as I previously showed in <a href="../ssh-over-ssl-a-quick-and-minimal-config.html">a previous post</a>.  Sadly,
the current version of apache does not allow to do it over https. There
has been a ...</p> 
	<a class="btn btn-mini xsmall" href="http://blog.chmd.fr/ssh-over-ssl-episode-3-avoiding-using-a-patched-apache.html">
          <i class="icon-plus-sign"></i> Read More </a>
	<hr />
      </div>
      
    </div>
      
    
 
        



    <div class='row-fluid'>
      <div class='article-title span9'> 
        <a href="http://blog.chmd.fr/ssh-over-ssl-episode-2-replacing-proxytunnel-with-socat.html"><h1>SSH over SSL, episode 2: replacing proxytunnel with socat</h1></a>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
	<p>Mon 15 November 2010 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.chmd.fr/category/howto.html">howto</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.chmd.fr/tag/socat.html">socat</a> <a href="http://blog.chmd.fr/tag/ssh.html">ssh</a> <a href="http://blog.chmd.fr/tag/ssl.html">ssl</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="chmduquesne">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="summary span8">
	<p>Last week, I wrote <a href="../ssh-over-ssl-a-quick-and-minimal-config.html">an article about how to quickly set up a server and a
client for doing ssh over ssl</a>.  In this article, I was using
proxytunnel, but I realized today that it could probably be replaced with
socat (socat can do almost anything)...</p>
<p>The principle is simple ...</p> 
	<a class="btn btn-mini xsmall" href="http://blog.chmd.fr/ssh-over-ssl-episode-2-replacing-proxytunnel-with-socat.html">
          <i class="icon-plus-sign"></i> Read More </a>
	<hr />
      </div>
      
    </div>
      
    
 
        



    <div class='row-fluid'>
      <div class='article-title span9'> 
        <a href="http://blog.chmd.fr/ssh-over-ssl-a-quick-and-minimal-config.html"><h1>SSH over SSL, a quick and minimal config.</h1></a>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span2">
	<p>Fri 12 November 2010 </p>

<p style="text-align: left;">
Filed under <a href="http://blog.chmd.fr/category/howto.html">howto</a>
</p>
<p style="text-align: left;">
 
    Tags <a href="http://blog.chmd.fr/tag/apache.html">apache</a> <a href="http://blog.chmd.fr/tag/ssh.html">ssh</a> <a href="http://blog.chmd.fr/tag/ssl.html">ssl</a> <a href="http://blog.chmd.fr/tag/tunnel.html">tunnel</a> </p>
<p>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="chmduquesne">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</p>
      </div>
      <div class="summary span8">
	<p>So you are behind a vicious firewall that filters outgoing ssh and
vpn, and the only safe way out is SSL. In this article, I'll
describe how to SSH over SSL to a machine that runs an ssh server
and apache2. This machine will still be able to run ...</p> 
	<a class="btn btn-mini xsmall" href="http://blog.chmd.fr/ssh-over-ssl-a-quick-and-minimal-config.html">
          <i class="icon-plus-sign"></i> Read More </a>
	<hr />
      </div>
      
    </div>
      
            <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://blog.chmd.fr/tag/ssh.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>    
 
  
        </div>
        
        
    </div>     </div> </div>

<!--footer-->
<div class="container">
  <div class="well" style="background-color: #E9EFF6">
    <div id="blog-footer">
      <div class="row-fluid">
		<div class="social span2" align="center" id="socialist">
	  <ul class="nav nav-list">
	    <li class="nav-header">
	      Social
	    </li>
	    	    <li><a href="https://twitter.com/#!chmduquesne"><i class="icon-twitter" style="color: #1f334b"></i>twitter</a></li>
	    	    <li><a href="http://resume.chmd.fr"><i class="icon-resume" style="color: #1f334b"></i>resume</a></li>
	                
	  </ul>
	</div>
		        	<div class="site-nav span2" align="center">
          <ul class="nav nav-list" id="site-links">
            <li class="nav-header"> 
              Site
            </li>
            <li><a href="http://blog.chmd.fr"><i class="icon-home" style="color: #1f334b">
                </i>Home</a></li>
            <li><a href="http://blog.chmd.fr/archives.html"><i class="icon-list" style="color: #1f334b">
                </i>Archives</a></li>
	    <li><a href="http://blog.chmd.fr/tags.html"><i class="icon-tags" style="color: #1f334b">
                </i>Tags</a></li>
	    
	                <li><a href="http://blog.chmd.fr/" rel="alternate">
                <i class="icon-rss-sign" style="color: #1f334b"></i>
                Atom Feed</a></li>
	  </ul>

        </div>

      </div> <!--end of fluid row-->
    </div> <!--end of blog-footer-->
    <hr />
    <p align="center"><a href="http://blog.chmd.fr">Ch-M.D</a>
      &copy; Tof
    Powered by <a href="github.com/getpelican/pelican">Pelican</a> and
        <a href="https://twitter.github.com/bootstrap">Twitter Bootstrap</a>. 
        Icons by <a href="http://fortawesome.github.com/Font-Awesome">Font Awesome</a> and 
        <a href="http://gregoryloucas.github.com/Font-Awesome-More">Font Awesome More</a></p>

  </div> <!--end of well -->
</div> <!--end of container -->

<!--/footer-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>


<script>var _gaq=[['_setAccount','UA-17659080-3'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

</body>
</html>