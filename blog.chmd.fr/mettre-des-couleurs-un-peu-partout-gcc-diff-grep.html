<!DOCTYPE html>
<html lang="en">
<head>
                <title>Mettre des couleurs un peu partout (gcc, diff, grep...)</title>
        <meta charset="utf-8" />
                <link href="http://blog.chmd.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D Full Atom Feed" />
                                                <link href="http://blog.chmd.fr/feeds/howto.atom.xml" type="application/atom+xml" rel="alternate" title="Ch-M.D Categories Atom Feed" />
                                        <link rel="stylesheet" href="/theme/css/rdark.css" />
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
        </head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Ch-M.D <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
                                          </ul></nav><!-- /#menu -->
        <section id="content" class="body">
<article>
        <header> <h1 class="entry-title"><a href="mettre-des-couleurs-un-peu-partout-gcc-diff-grep.html"
        rel="bookmark" title="Permalink to Mettre des couleurs un peu partout (gcc, diff, grep...)">Mettre des couleurs un peu partout (gcc, diff, grep...)</a></h1></header>
        <div class="entry-content">
        <!-- /.post-info -->
        <p>Aujourd'hui, après avoir passé un bout de temps à déchiffrer la
sortie d'une compilation, je me suis mis en quête d'améliorer mon
quotidien et d'y mettre... des couleurs! Pour ce faire, on cherche
un peu ce qui existe déjà, et on tombe sur colorgcc. C'est
disponible sur pas mal de distributions, c'est juste un script perl
à appeler à la place de gcc, et ça rajoute des couleurs. Pour en
profiter, il suffit de glisser dans vos Makefile</p>
<div class="highlight"><pre><span class="n">CXX</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">colorgcc</span>
</pre></div>


<p>Avec les autotools, on peut régler ça à l'invocation du script
configure :</p>
<div class="highlight"><pre><span class="p">.</span><span class="o">/</span><span class="n">configure</span> <span class="n">CXX</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">colorgcc</span>
</pre></div>


<p>Bon. Pas mal. Maintenant, les diff. Au boulot, je n'ai pas mieux
sous la main qu'un svn comme gestionnaire de version. Quand je me
tape des svn diff, j'aime bien que ça soit un peu lisible. Et si on
se mettait ça en couleurs? En lisant un peu la doc, on voit qu'il
suffit de se faire un script. Mettons diffwrap.sh.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/sh</span>
<span class="c"># Configure your favorite diff program here.</span>
<span class="nv">DIFF</span><span class="o">=</span><span class="s2">&quot;/usr/bin/colordiff&quot;</span>
<span class="c"># Subversion provides the paths we need as the sixth and seventh</span>
<span class="c"># parameters.</span>
<span class="nv">LEFT</span><span class="o">=</span><span class="k">${</span><span class="nv">6</span><span class="k">}</span>
<span class="nv">RIGHT</span><span class="o">=</span><span class="k">${</span><span class="nv">7</span><span class="k">}</span>
<span class="c"># Call the diff command</span>
<span class="nv">$DIFF</span> <span class="nv">$LEFT</span> <span class="nv">$RIGHT</span>
<span class="c"># Return an errorcode of 0 if no differences were detected, 1 if some were.</span>
<span class="c"># Any other errorcode will be treated as fatal.</span>
</pre></div>
</td></tr></table>

<p>J'ai installé colordiff pour faire le boulot. Il suffit après
d'éditer \~/.subversion/config, et d'ajouter, section [helpers]</p>
<div class="highlight"><pre><span class="n">diff</span><span class="o">-</span><span class="n">cmd</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">diffwrap</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>Bon ok, mais quand je fais make, j'ai toujours beaucoup de sortie
Il n'y aurait pas moyen de se cantonner aux erreurs gcc lorsqu'il y
en a? Aller, on va baisser un peu ça avec un petit peu (le -j3 est
pour multithreader le make : j'ai un dual core, autant en
profiter).</p>
<div class="highlight"><pre><span class="n">alias</span> <span class="n">make</span><span class="o">=</span><span class="err">&#39;</span><span class="n">make</span> <span class="o">-</span><span class="n">j3</span> <span class="o">-</span><span class="n">s</span><span class="err">&#39;</span>
</pre></div>


<p>Bien entendu, en tant qu'adepte de vim, j'utilise aussi beaucoup
:make. Dans le .vimrc, il peut s'avérer utile de glisser alors:</p>
<div class="highlight"><pre><span class="n">autocmd</span> <span class="n">BufNewFile</span><span class="p">,</span><span class="n">BufRead</span><span class="p">,</span><span class="n">BufEnter</span> <span class="o">*</span><span class="p">.</span><span class="n">cpp</span><span class="p">,</span><span class="o">*</span><span class="p">.</span><span class="n">hpp</span> <span class="n">set</span> <span class="n">makeprg</span><span class="o">=</span><span class="n">make</span><span class="err">\</span> <span class="o">-</span><span class="n">j3</span><span class="err">\</span> <span class="o">-</span><span class="n">s</span>
</pre></div>


<p>Au passage, j'espère que vous connaissiez
<a href="http://www.vim.org/scripts/script.php?script_id=1520">omnicppcomplete</a>,
qui va chez moi dans la même section du .vimrc:</p>
<div class="highlight"><pre><span class="n">autocmd</span> <span class="n">BufNewFile</span><span class="p">,</span><span class="n">BufRead</span><span class="p">,</span><span class="n">BufEnter</span> <span class="o">*</span><span class="p">.</span><span class="n">cpp</span><span class="p">,</span><span class="o">*</span><span class="p">.</span><span class="n">hpp</span> <span class="n">set</span> <span class="n">omnifunc</span><span class="o">=</span><span class="n">omni</span><span class="err">#</span><span class="n">cpp</span><span class="err">#</span><span class="n">complete</span><span class="err">#</span><span class="n">Main</span>
</pre></div>


<p>On combine tout ça à quelques alias assez connus, et on vit un peu
mieux dans sa console...</p>
<div class="highlight"><pre><span class="cp"># SOME COLORS</span>
<span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dircolors</span> <span class="p">];</span> <span class="n">then</span>
    <span class="n">eval</span> <span class="s">&quot;`dircolors -b`&quot;</span>
    <span class="n">alias</span> <span class="n">ls</span><span class="o">=</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">--</span><span class="n">color</span><span class="o">=</span><span class="k">auto</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">dir</span><span class="o">=</span><span class="err">&#39;</span><span class="n">dir</span> <span class="o">--</span><span class="n">color</span><span class="o">=</span><span class="k">auto</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">vdir</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vdir</span> <span class="o">--</span><span class="n">color</span><span class="o">=</span><span class="k">auto</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">grep</span><span class="o">=</span><span class="err">&#39;</span><span class="n">grep</span> <span class="o">--</span><span class="n">color</span><span class="o">=</span><span class="k">auto</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">fgrep</span><span class="o">=</span><span class="err">&#39;</span><span class="n">fgrep</span> <span class="o">--</span><span class="n">color</span><span class="o">=</span><span class="k">auto</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">egrep</span><span class="o">=</span><span class="err">&#39;</span><span class="n">egrep</span> <span class="o">--</span><span class="n">color</span><span class="o">=</span><span class="k">auto</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">diff</span><span class="o">=</span><span class="err">&#39;</span><span class="n">colordiff</span><span class="err">&#39;</span>
    <span class="n">alias</span> <span class="n">less</span><span class="o">=</span><span class="err">&#39;</span><span class="n">less</span> <span class="o">-</span><span class="n">R</span><span class="err">&#39;</span>
<span class="n">fi</span>
</pre></div>


<p>Si vous avez des trucs utiles, n'hésitez pas! Je suis en
particulier à la recherche d'un script vim qui exploiterait un rien
les options 'errorformat' et 'QuickFixCmdPost' afin d'améliorer
encore la lisibilité des compilations dans la fenêtre quickfix.</p>
        </div><!-- /.entry-content -->
                <div class="comments">
        <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
               var disqus_identifier = "mettre-des-couleurs-un-peu-partout-gcc-diff-grep.html";
               (function() {
               var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
               dsq.src = '//chmd.disqus.com/embed.js';
               (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
        </div>
        
</article>
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Generated by <a href="http://getpelican.com/">pelican</a>,
                theme <a href="https://github.com/chmduquesne/small">small</a>
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>